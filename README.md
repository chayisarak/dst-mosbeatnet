# 🦟 A Noise-Resilient Model for Mosquito Species and Sex Detection via Wingbeat Sound Around Noisy Environment

This project presents a simulation-based training and evaluation framework to develop mosquito sound detection models robust to real-world noise. The system focuses on training with realistic acoustic scenes using synthetic data that combines clean mosquito wingbeat recordings with environmental noise.

---

## 🎯 Objective

To develop and evaluate mosquito detection models that perform reliably under environmental noise conditions. The goal is to simulate realistic auditory environments (e.g., urban, forest) and train models that generalize well to noisy deployment settings.

---

## 📁 Datasets

### 🦟 Wingbeat Dataset
- Sources: [HumBugDB]([https://humbug.ac.uk/](https://github.com/HumBug-Mosquito/HumBugDB), [MosquitoSong+]([https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0310121])
- Species:  
  - *Aedes aegypti*, *Culex quinquefasciatus* (Urban)  
  - *Aedes albopictus*, *Anopheles dirus* (Forest)

### 🔊 Noise Dataset
- Source: [BBC Sound Effects Library (RemArc License)](https://sound-effects.bbcrewind.co.uk/)
- Two acoustic domains:
  - 🌳 Forest: insects, birds, streams, wind, etc.
  - 🏙️ Urban: traffic, AC, crowd, motorbike, etc.
- **Train/Test noises are non-overlapping**

---

## 🎛️ Data Simulation Pipeline

Each 10-second simulated clip is generated by overlaying mosquito flight tones onto environmental sounds.

### Key Steps:
- **Event Timing**: Randomized using *Exponential Distribution*
- **Overlay Methods**:
  - Fade-in / Fade-out smoothing
  - SNR-controlled overlay:
    - Urban: 5–15 dB
    - Forest: 15–25 dB
  - Power scaling: `x_scaled = sign(x) * |x|^0.8`
  - RMS normalization to target –20 dBFS

### Segmenting:
- Each audio file is split into **20 segments** of 0.5s duration

---

## 🧪 Dataset Statistics

| Split       | Files  | Segments |
|-------------|--------|----------|
| Train       | 6,650  | 133,000  |
| Validation  | 1,425  | 28,500   |
| Test        | 1,550  | 31,000   |
| Noise-only  | +250   | –        |

- **Total**: 192,500 segments  
- **+250 noise-only samples** (125 per environment) to improve robustness

---

## ⚙️ Model Training

- **Architecture**: Options include `Mosbeatnet`, `MosqPlusModel`, etc.
- **Loss**: `CrossEntropyLoss`
- **Optimizer**: Adam (`lr = 0.001`)
- **Batch Size**: 64
- **Augmentation**: (Train only)
  - Noise injection (random gain)
  - Pitch shifting (±3 semitones)
  - Time stretching (0.8–1.2×)

Regenerate training dataset every 10 epochs to introduce variability. First 5 epochs use clean data for stable initialization.

---

## 📊 Evaluation Metrics

### 📍 Segment-Level
- Accuracy, F1-score, Macro F1, Balanced Accuracy
- Per-class precision, recall, and support

### 🕒 Event-Level (Temporal Evaluation)
- Group consecutive predicted segments into **events**
- Use **IoU ≥ 0.5** to match prediction with ground truth
- Report:
  - Temporal Precision / Recall / F1
  - TP / FP / FN per event
  - Onset/offset/duration error per class

> ❗ **True Negatives (TN)** are not counted in temporal metrics, consistent with SED literature (e.g., Mesaros et al.)

---

## ▶️ Script: `run_forest_main.py`

This is the main pipeline script for the Forest environment.

### ✅ Features:
- Sets config: `ENV_SCOPE = "forest"`
- Simulates datasets (train/val/test + noise-only)
- Merges indoor & outdoor metadata
- Builds and trains the selected model (uncomment to activate)
- Loads latest model checkpoint
- Evaluates segment-level and event-level metrics
- Saves:
  - Prediction CSVs
  - Confusion matrix & accuracy reports
  - Event-based metrics 

### 🔄 Usage:

```bash
python run_forest_main.py
```

## ▶️ Script: `run_forest_main.py`

This is the main pipeline script for the Forest environment.

### ✅ Features:
- Sets config: `ENV_SCOPE = "urban"`
- Simulates datasets (train/val/test + noise-only)
- Merges indoor & outdoor metadata
- Builds and trains the selected model (uncomment to activate)
- Loads latest model checkpoint
- Evaluates segment-level and event-level metrics
- Saves:
  - Prediction CSVs
  - Confusion matrix & accuracy reports
  - Event-based metrics 

### 🔄 Usage:

```bash
python run_urban_main.py
```
